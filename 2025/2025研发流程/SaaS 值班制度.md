

# **一、值班目标**

确保生产系统在 7×24 小时内具备可靠的应急响应能力，快速发现并处理故障，保障业务连续性。


# **二、值班范围**

重点关注如下两个群组：

* **石墨 99999**
* **石墨应急小组**



【石墨 99999 群】和【石墨应急小组】群如果有告警日志，需要在响应时效内及时处理。



# **三、值班原则**

1. **轮值制**：每位SRE工程师均参与值班轮换。

2. **明确责任**：Oncall工程师对值班周期内的报警处理负责。

3. **快速响应**：告警响应时效 ≤ 5分钟。


# **四、值班分层架构**

|层级|角色|职责|响应时效|
|:----|:----|:----|:----|
|L1|SRE/QA值班人|接收告警、初步分析、执行Runbook恢复|5分钟|
|L2|研发值班人|指导复杂问题、评估风险、决策回滚|15分钟|
|L3|系统Owner|根因分析、代码修复、后续优化|30分钟|


# **五、值班排班方式**

## **1. 轮值周期**

* 周期：每周轮换一次（周一 10:00 至下周一 10:00）

* 每个轮值周期安排SRE、研发、测试各一人

* 轮值期内若有事请假需与其他值班人调换，需要在SaaS值班群中通知


## **2. 排班表**

|序号|值班人|联系方式|
|:----|:----|:----|
|1|罗沙|18618405910|
|2|龚龙|13597476155|
|3|李想|18701307268|
|4|李澳|15717257465|
|5|沈合胜|18971978053|
|6|程杰|13407148352|
|7|骆寿祥|13554113502|
|8|叶慧玥|15827345157|

详细值班安排：[值班安排](https://shimo.im/sheets/L9kBBBN8P7cXQJkK/MODOC)


# **六、告警与响应流程**

### **1. 告警来源**

* 钉钉59群

* CV日志平台告警规则

* MDP K8S Event / Pod CrashLoop

* Prometheus / Grafana Alert

* 华为云监控事件


### **2. 通知渠道**

* 钉钉 / 电话

* 告警内容包含：服务名、影响范围、告警级别、触发时间、Runbook链接


### **3. 响应流程**

值班问题记录表：[https://shimo.net/wiki/fN4bhgZXMfZo1Eqr](https://shimo.net/wiki/fN4bhgZXMfZo1Eqr)

# **七、告警分级与处理标准**

|等级|描述|值班人|处理人|通知|
|:----|:----|:----|:----|:----|
|P0|影响核心业务，服务不可用。核心业务频繁 OOM 或报错|立即响应处置，应立即上报联系相关人员处理|处理人收到响应通知后需要立刻处理。处理人无法联系的情况，应立即上报 Leader 处理|钉钉 59群|
|P1|影响部分功能或用户体验下降。业务频繁 OOM 或报错|立即响应处置，应立即上报联系相关人员处理|处理人收到响应通知后需要立刻处理。处理人无法联系的情况，应立即上报 Leader 处理|钉钉 59群|
|P2|仅内部服务告警或单节点异常（通常来自华为云服务）业务偶发 OOM 或报错|5min内响应，需响应告警事件，反馈记录接下来的处置方案|收到响应通知后需要立刻处理，需要在最近的工作日处理|钉钉 低风险群|
|P3|性能或容量趋势性问题，对业务无影响（通常来自华为云服务）业务偶发 OOM 或报错|5min内响应，需响应告警事件，反馈记录接下来的处置方案|收到响应通知后需要立刻处理，需要在最近的工作日处理|钉钉 低风险群|


* 核心业务定义如下：

   * svc-edit-*

   * svc-file-*

   * svc-auth-*

   * svc-user-*

   * app-api-*

   * sdk-api-*

   * serverless-compose-*

* 『频繁』的定义：

   * 3 分钟内有 >= 3 次 OOM、重启、报错

* 『偶发』的定义：

   * 3 分钟内有 < 3 次 OOM、重启、报错


## **7.1. P0 级别告警案例及处理流程**

适用于以下系统和组件：

* 核心业务服务（前端、后端、API 网关）

   * 频繁OOM 或报错联系对应研发处理，如果联系不上对应研发，需要向上升级，联系对应的 Leader

* 中间件服务（MySQL、Redis、MongoDB、Kafka、Elasticsearch、OBS、CDN）

   * 联系 SRE（罗沙）处理

* 基础设施（Kubernetes、CI/CD 监控与日志系统）

   * 联系 SRE（罗沙）处理

* 网络与节点层（带宽、负载均衡、Ingress、ECS 节点健康）

   * 联系 SRE（罗沙）处理


## **7.2. P1 级别告警案例及处理流程**

适用于如下告警：

* 任何服务频繁OOM，包含且不限于：

   * svc-edit-*

   * svc-file-*

   * svc-auth-*

   * svc-user-*

   * app-api-*

   * sdk-api-*

   * serverless-compose-*

   * svc-utils-*

   * svc-oss-*

   * ...



此类告警，一旦出现，可以联系对应研发处理


## **7.3. P2、P3 级别告警案例及处理流程**

* 核心服务偶发报错

   * 留言联系对应研发根据实际情况处理

* 非核心服务偶发 OOM

   * 留言联系对应研发根据实际情况处理


# **八、SOP管理**

* 每个组件必须有对应的**SOP**

   * 研发人员需定期更新SOP手册

   * 内容包括：

      * 告警定义与触发条件

      * 快速检查命令与脚本

      * 常见恢复措施（重启、回滚、扩容）

      * 责任人和关联系统

* 每次事件复盘后更新SOP。

# **九、应急通信与联络信息**

* 值班群：钉钉59群

* Oncall联系电话：

   * 前端

      * 格式转换：郑细弯18207143955

      * 轻文档/主站：刘津玮18627098826

      * 三表：王珂珂18674087930

      * 幻灯片：张萌 19947558207

   * 后端

      * 郑伟18827073672

   * 运维

      * 罗沙18618405910

* 外部支持

   * 华为云  微群专属群（客服经理 孙林）


# **十、具体案例 SOP 手册**

## **10.1. svc-file-drive 偶发 OOM**

* 问题级别：P2

* 现象：svc-file-drive 出现偶尔 OOM 的问题。

* 根因：file-drive 文件上传走了后端上传，短时间内上传大文件会有 OOM 的风险

* 处理方式：保持关注，如果未持续频繁 OOM，暂时不用处理

* 回复方式：关注中，如有频繁 OOM 会联系研发排查

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.2. svc-table*、应用表格等偶发报错**

* 问题级别：P1

* 现象：99999 群可能会出现『应用表格保存失败』、『应用表格 svc-table 5xx 告警』等应用表格相关的报错

* 根因：未知，需要现场排查

* 处理方式：联系唐彪柯特处理

* 回复方式：联系唐彪柯特处理


## **10.3. smpro-svc-search-worker-*偶发 OOM**

* 问题级别：P2

* 现象：svc-search-worker-*突然会有一波 OOM

* 根因：如果有新入加入团队，目前会对新人的文档及其团队的历史文档做 ES 的更新处理，此时会对 ES 更新的 worker 有比较大的负担。

* 处理方式：保持关注，如果未持续频繁 OOM，暂时不用处理。后续需要优化 ES 更新的频率，减少对 searc-worker 并发处理的负载。

* 回复方式：关注中，如有频繁 OOM 会联系研发排查。

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.4.INGRESS_ERR Nginx 报错**

* 问题级别：P1

* 现象：99999 群可能收到 INGRESS_ERR 的报错

* 根因：未知，需要现场排查

* 处理方式：

   * 点击INGRESS_ERR 中的 「【链接跳转】:[https://mdp.shimodev.com/clickvisual/api/share/0000254297](https://mdp.shimodev.com/clickvisual/api/share/0000254297)」

   * 分析查看 Nginx 的具体报错

   * 提供报错截图，联系罗沙处理

* 回复方式：已联系 SRE 和研发处理


## **10.5.app-api 偶发 OOM**

* 问题级别：P2

* 现象：smpro-app-api-* 频繁 OOM

* 根因：未知，需要现场排查

* 处理方式：联系郑伟处理

* 回复方式：已联系郑伟处理

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.6. svc-file 偶发 OOM**

* 问题级别：P2

* 现象：smpro-svc-file-* 频繁 OOM

* 根因：未知，需要现场排查

* 处理方式：联系王洋洋处理

* 回复方式：已联系王洋洋处理

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.7.专业表格获取内容失败**

* 问题级别：P1

* 现象：专业表格获取内容失败

* 根因：未知，需要现场排查

* 处理方式：联系王珂珂处理

* 回复方式：已联系王珂珂处理


## **10.8. lib-compose、serverless-compose-* 偶发 OOM**

* 问题级别：P2

* 现象：serverless-compose-*偶发 OOM

* 根因：fc 处理大的 changesets 导致的

* 处理方式：保持关注，如果持续频繁时间 OOM 需要联系段律

* 回复方式：偶发 OOM，保持关注，如持续频繁 OOM 会连续段律处理

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.9.EGO UCODE 5XX 告警**

* 问题级别：P1

* 现象：EGO UCODE 5XX

* 根因：未知，需要现场排查

* 处理方式：

   * 点击EGO UCODE 5XX 告警中的 「【链接跳转】:[https://mdp.shimodev.com/clickvisual/api/share/xxxxxxxxx](https://mdp.shimodev.com/clickvisual/api/share/xxxxxxxxx)」

   * 分析查看 EGO 的具体报错，并提供报错截图

   * 提供报错截图，联系郑伟处理

* 回复方式：已联系郑伟处理


## **10.10.节点触发 System OOM**

* 问题级别：P0

* 现象：节点触发 System OOM

* 根因：某部署在此节点上的 POD 使用中出现内存突刺导致的

* 处理方式：立刻联系罗沙处理，需要排查潜在的 POD，联系研发确认下是否有优化方案

* 回复方式：已联系罗沙处理


## **10.11.office-word-rs、office-light-doc-rs 偶发 OOM**

* 问题级别：P2

* 现象：office-word-rs OOM

* 根因：未知，需要现场排查

* 处理方式：立刻联系郑细弯罗沙处理

* 回复方式：已联系细弯处理

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.12.shimopro-pro_audit 数据库实例磁盘容量触发告警**

* 问题级别：P0

* 现象：pro_audit 磁盘利用率连续 5 次 5 分钟平均值 >= 85 %

* 根因：数据库磁盘利用率提升

* 处理方式：立刻联系罗沙处理，确认是否需要扩容

* 回复方式：已联系罗沙处理


## **10.13.INGRESS_ERR Nginx 偶发报错**

* 问题级别：P2

* 现象：Nginx 偶发报错

* 根因：未知，需要现场排查

* 处理方式：立刻联系罗沙处理

* 回复方式：已联系罗沙处理

* 其他：如果频繁OOM，需要升级成 P1，联系处理人立即处理


## **10.14. 用户保存消息 Kafka 堆积告警**


* 问题级别：P2

* 现象：极小部分用户可能出现保存慢的问题

* 根因：kafka 某个分区出现突发流量，后端处理慢导致

* 处理方式：根据文档处理[https://shimo.im/docs/KXF4NLzyWjo4SbCI](https://shimo.im/docs/KXF4NLzyWjo4SbCI)

* 回复方式：在石墨 99999 群中同步进度

* 其他：如果长时间持续，需要升级成 P1，联系杜旻翔立即处理













